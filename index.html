<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gourmet Patagon - GestiÃ³n de Pedidos</title>
    <style>
        :root { --primary: #e67e22; --dark: #2c3e50; --success: #25d366; --bg: #fdfaf6; --danger: #e74c3c; --blue: #3498db; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--dark); padding: 10px; margin: 0; }
        .container { max-width: 480px; margin: auto; background: white; padding: 20px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .header { text-align: center; margin-bottom: 20px; border-bottom: 2px solid var(--primary); padding-bottom: 10px; }
        .step-title { font-size: 0.9rem; color: var(--primary); text-transform: uppercase; font-weight: 800; margin: 15px 0 10px; border-bottom: 1px solid #eee; }
        
        .logistica-box { background: #fff5eb; padding: 15px; border-radius: 15px; border: 1px solid var(--primary); margin-bottom: 15px; }
        .confirm-frame { border: 2px solid var(--danger); padding: 10px; border-radius: 10px; background: #fff1f0; display: flex; align-items: center; justify-content: center; margin-top: 10px; }
        
        .info-transferencia { background: #eef2f7; border: 2px solid var(--blue); padding: 15px; border-radius: 15px; margin: 10px 0; font-size: 0.85rem; display: none; }
        .gourmet-info { background: #fdf2f2; border: 1px solid #f5c2c7; color: #842029; padding: 12px; border-radius: 12px; margin-top: 10px; font-size: 0.85rem; }

        .grid-combos { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .combo-card { border: 2px solid #f0f0f0; padding: 12px; border-radius: 15px; text-align: center; cursor: pointer; position: relative; }
        .combo-card input { position: absolute; opacity: 0; }
        .combo-card:has(input:checked) { border-color: var(--primary); background: #fff5eb; }

        .selector-box { background: #f9f9f9; padding: 15px; border-radius: 15px; margin-bottom: 10px; display: none; border-left: 5px solid var(--primary); }
        select, input, textarea { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 10px; font-size: 1rem; box-sizing: border-box; }
        
        /* Layout Compacto para Extras y ProteÃ­nas */
        .compact-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 0.85rem; }
        .check-row { display: flex; align-items: center; gap: 8px; font-weight: bold; background: #fff; padding: 8px; border-radius: 8px; border: 1px solid #eee; }

        .resumen-lista { background: #fff; border: 1px solid #eee; border-radius: 15px; padding: 10px; margin-top: 15px; }
        .cart-item { background: #f8f9fa; padding: 12px; border-radius: 10px; margin-bottom: 8px; font-size: 0.85rem; border-left: 4px solid var(--primary); display: flex; justify-content: space-between; align-items: center; }
        
        .total-banner { background: var(--dark); color: white; padding: 15px; border-radius: 15px; text-align: center; font-weight: bold; font-size: 1.2rem; margin: 15px 0; }
        button { border-radius: 12px; width: 100%; font-weight: bold; cursor: pointer; border: none; }
        .btn-add { background: var(--primary); color: white; padding: 15px; margin-top: 10px; }
        .btn-send { background: var(--success); color: white; padding: 20px; font-size: 1.2rem; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h2>ğŸ”ï¸ EL GOURMET PATAGON</h2>
        <span>Cocina Taller - Coyhaique</span>
    </div>

    <div class="step-title">1. LogÃ­stica ğŸšš</div>
    <div class="logistica-box">
        <input type="text" id="nombre" placeholder="Nombre y Apellido">
        <input type="text" id="direccion" placeholder="DirecciÃ³n de entrega">
        <select id="modalidad" onchange="render()">
            <option value="reparto">Servicio de Reparto (12:45 - 13:30)</option>
            <option value="retiro">Retiro en Cocina Taller (Incentivo -$500)</option>
        </select>
        <select id="zona" onchange="render()">
            <option value="0">Centro hasta Victoria (GRATIS)</option>
            <option value="1500">Victoria hacia ğŸ”ï¸ (+$1.500)</option>
        </select>
        
        <div id="msg-retiro" style="color:#b91c1c; font-size:0.8rem; display:none; margin:10px 0; text-align:center; font-weight:bold;">âš ï¸ HORA LÃMITE RETIRO: 12:30 a 12:45 hrs.</div>

        <div class="confirm-frame">
            <label style="font-size:0.85rem; font-weight:bold; cursor:pointer; color:var(--danger);">
                <input type="checkbox" id="acepta_horario"> Â¡Confirmo mi pedido y horario! âœ…
            </label>
        </div>
    </div>

    <div class="step-title">2. Arma tu Plato ğŸ§©</div>
    <div class="grid-combos">
        <label class="combo-card"><input type="radio" name="combo" value="7500" data-name="MenÃº A" onclick="checkPromo('A')"><b>MenÃº A</b><br><span>$7.500</span></label>
        <label class="combo-card"><input type="radio" name="combo" value="8500" data-name="MenÃº B" onclick="checkPromo('B')"><b>MenÃº B</b><br><span>$8.500</span></label>
        <label class="combo-card"><input type="radio" name="combo" value="3500" data-name="Sopa/Crema" onclick="checkPromo('S')"><b>Sopa</b><br><span>$3.500</span></label>
        <label class="combo-card"><input type="radio" name="combo" value="3500" data-name="Dulce" onclick="checkPromo('D')"><b>Dulce</b><br><span>$3.500</span></label>
    </div>

    <div id="promo-box" style="background:#ebf5ff; padding:15px; border-radius:15px; border:2px dashed var(--blue); margin-bottom:15px; display:none; text-align:center; cursor:pointer;" onclick="aplicarPromo()">
        ğŸ¥ <b>EXPERIENCIA COMPLETA</b><br><small>Suma tu Dulce por <b>+$2.000</b>. Â¡Pincha aquÃ­! âœ¨</small>
    </div>

    <div id="ui-entrante" class="selector-box"><b>Entrante:</b><select id="entrante_val"><option value="Sopa/Crema">ğŸ¥£ Sopa/Crema</option><option value="Mix de Temporada">ğŸ¥— Mix de Temporada</option></select></div>
    
    <div id="ui-principal" class="selector-box"><b>Principal:</b><select id="principal_val" onchange="toggleProt()"><option value="Plato del DÃ­a">ğŸ¥˜ Plato del DÃ­a</option><option value="La Gran Ensalada">ğŸ¥— La Gran Ensalada</option></select>
        <div id="ui-prot" style="display:none; margin-top:10px;">
            <b>Elegir 2 ProteÃ­nas:</b>
            <div class="compact-grid">
                <label class="check-row"><input type="checkbox" class="p-check" value="Quinoa" onclick="autoCheckExtra()"> Quinoa</label>
                <label class="check-row"><input type="checkbox" class="p-check" value="Huevo" onclick="autoCheckExtra()"> Huevo</label>
                <label class="check-row"><input type="checkbox" class="p-check" value="Lentejas" onclick="autoCheckExtra()"> Lentejas</label>
                <label class="check-row"><input type="checkbox" class="p-check" value="Ave" onclick="autoCheckExtra()"> Ave</label>
            </div>
        </div>
    </div>

    <div class="step-title">Complementos âœ¨</div>
    <div class="compact-grid" style="margin-bottom:10px;">
        <label class="check-row"><input type="checkbox" id="bamboo"> ğŸ‹ Bamboo (+$1k)</label>
        <label class="check-row"><input type="checkbox" id="jugo"> ğŸ‹ Dressing (+$1k)</label>
        <label class="check-row" style="grid-column: span 2;"><input type="checkbox" id="extra_prot"> ğŸ¥© ProteÃ­na Extra (+$1.000)</label>
    </div>

    <button class="btn-add" onclick="addItem()">â• AÃ‘ADIR SELECCIÃ“N</button>

    <div id="resumen_visual" style="display:none; margin-top:20px;"><div class="step-title">Tu Comanda ğŸ›ï¸</div><div id="items_cart" class="resumen-lista"></div></div>

    <div class="step-title">3. Pago Final ğŸ’°</div>
    <select id="pago" onchange="render()">
        <option value="">Selecciona Pago...</option>
        <option value="Transferencia">Transferencia (-$500)</option>
        <option value="Efectivo">Efectivo</option>
    </select>

    <div id="info-tr" class="info-transferencia">
        <b>BCI Cta Corriente: 30763118</b><br>Alex Berrios | 15.841.237-3
        <button class="btn-copy" onclick="copyData()" style="margin:10px 0; background:var(--blue); color:white; padding:8px; width:100%; border-radius:8px;">ğŸ“‹ COPIAR DATOS DE PAGO</button>
        <div class="gourmet-info">ğŸ‘¨â€ğŸ³ <b>Trato hecho:</b> Cocinamos al momento tras recibir tu comprobante para asegurar la calidad Patagon.</div>
    </div>

    <div id="info-ef" style="display:none;"><input type="number" id="paga_con" placeholder="Â¿Con cuÃ¡nto pagas?" onkeyup="calcVuelto()"><div id="vuelto_resultado" style="background:#dcfce7; padding:10px; border-radius:10px; font-weight:bold; display:none; margin-top:5px;"></div></div>

    <textarea id="observaciones" rows="2">ğŸ¤¤ğŸ‘¨ğŸ½â€ğŸ³ğŸ˜‹ğŸ’ªğŸ½</textarea>
    <div class="total-banner" id="total_final">TOTAL: $0</div>
    <button class="btn-send" onclick="send()">ENVIAR PEDIDO âœ…</button>
</div>

<script>
    const SHEET_URL = "TU_URL_AQUI"; 
    let cart = []; let totalGlobal = 0;

    async function enviarAGoogleSheets(datos) {
        if(SHEET_URL === "TU_URL_AQUI") return;
        fetch(SHEET_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(datos) });
    }

    function checkPromo(t){
        document.getElementById('ui-entrante').style.display=(t==='B')?'block':'none';
        document.getElementById('ui-principal').style.display=(t==='A'||t==='B')?'block':'none';
        document.getElementById('promo-box').style.display=(t==='A'||t==='B')?'block':'none';
    }

    function aplicarPromo(){
        cart.push({ name: "Dulce (Promo)", price: 2000, ent: "", pri: "", pts: "", extras: {bamboo:false, jugo:false, extra_prot:false}});
        document.getElementById('promo-box').style.display = 'none'; render();
    }

    function toggleProt(){ document.getElementById('ui-prot').style.display=(document.getElementById('principal_val').value==='La Gran Ensalada')?'block':'none'; }
    function autoCheckExtra(){ document.getElementById('extra_prot').checked = (document.querySelectorAll('.p-check:checked').length > 2); }
    function copyData(){ navigator.clipboard.writeText("BCI 30763118, Alex Berrios, 15.841.237-3"); alert("Datos copiados."); }

    function addItem(){
        const c = document.querySelector('input[name="combo"]:checked');
        const b = document.getElementById('bamboo').checked;
        const j = document.getElementById('jugo').checked;
        const ep = document.getElementById('extra_prot').checked;

        if(!c && !b && !j) return alert("Selecciona un plato o extra.");

        if(c){
            const isEnsalada = document.getElementById('principal_val').value === 'La Gran Ensalada' && (c.dataset.name.includes('MenÃº'));
            const prots = Array.from(document.querySelectorAll('.p-check:checked')).map(p => p.value);
            if(isEnsalada && prots.length < 2) return alert("Elige 2 proteÃ­nas.");

            cart.push({
                name: c.dataset.name, price: parseInt(c.value),
                ent: (c.dataset.name==='MenÃº B')?document.getElementById('entrante_val').value:'',
                pri: (c.dataset.name.includes('MenÃº'))?document.getElementById('principal_val').value:'',
                pts: isEnsalada ? prots.join("/") : "",
                extras: { bamboo: b, jugo: j, extra_prot: ep }
            });
            c.checked = false;
        } else {
            // Caso solo extras
            if(b) cart.push({ name: "Solo Cubiertos ğŸ‹", price: 1000, ent:"", pri:"", pts:"", extras: {bamboo:false, jugo:false, extra_prot:false}});
            if(j) cart.push({ name: "Solo Dressing ğŸ‹", price: 1000, ent:"", pri:"", pts:"", extras: {bamboo:false, jugo:false, extra_prot:false}});
        }

        document.querySelectorAll('.p-check').forEach(p => p.checked = false);
        ['bamboo','jugo','extra_prot'].forEach(id => document.getElementById(id).checked = false);
        render();
    }

    function render(){
        const itemsDiv = document.getElementById('items_cart'); itemsDiv.innerHTML = ""; let sub = 0;
        document.getElementById('resumen_visual').style.display = cart.length > 0 ? "block" : "none";
        cart.forEach((it, i) => {
            let itemTotal = it.price;
            let exT = (it.extras.bamboo?"+ğŸ‹ ":"")+(it.extras.jugo?"+ğŸ‹ ":"")+(it.extras.extra_prot?"+ğŸ¥©":"");
            if(it.extras.bamboo) itemTotal += 1000; if(it.extras.jugo) itemTotal += 1000; if(it.extras.extra_prot) itemTotal += 1000;
            sub += itemTotal;
            itemsDiv.innerHTML += `<div class="cart-item"><div><b>${it.name}</b><br><small>${it.ent} ${it.pri} ${it.pts}</small></div><div style="text-align:right"><b>$${itemTotal}</b><br><span onclick="cart.splice(${i},1);render()" style="color:red; cursor:pointer">Ã—</span></div></div>`;
        });
        const mod = document.getElementById('modalidad').value;
        const z = (mod === 'reparto') ? parseInt(document.getElementById('zona').value) : 0;
        const descR = (mod === 'retiro') ? -500 : 0;
        const descT = (document.getElementById('pago').value === 'Transferencia') ? -500 : 0;
        
        document.getElementById('msg-retiro').style.display = (mod === 'retiro') ? 'block' : 'none';
        document.getElementById('info-tr').style.display = (document.getElementById('pago').value === 'Transferencia') ? 'block' : 'none';
        document.getElementById('info-ef').style.display = (document.getElementById('pago').value === 'Efectivo') ? 'block' : 'none';
        
        totalGlobal = sub + z + descR + descT;
        document.getElementById('total_final').innerText = "TOTAL: $" + totalGlobal.toLocaleString('es-CL');
        calcVuelto();
    }

    function calcVuelto(){
        const pagaCon = parseInt(document.getElementById('paga_con').value);
        const v = document.getElementById('vuelto_resultado');
        if(!isNaN(pagaCon) && pagaCon >= totalGlobal && document.getElementById('pago').value === 'Efectivo'){
            v.style.display = 'block'; v.innerText = "Vuelto: $" + (pagaCon - totalGlobal).toLocaleString('es-CL');
        } else { v.style.display = 'none'; }
    }

    function send(){
        if(!document.getElementById('acepta_horario').checked) return alert("Por favor confirma el horario.");
        const n = document.getElementById('nombre').value; const p = document.getElementById('pago').value;
        if(!n || cart.length === 0 || !p) return alert("Faltan datos.");

        let detallePedido = cart.map(it => `${it.name}`).join(" | ");
        enviarAGoogleSheets({ nombre: n, modalidad: document.getElementById('modalidad').value, pedido: detallePedido, total: totalGlobal, pago: p, notas: document.getElementById('observaciones').value });

        let msg = `*PEDIDO PATAGON*%0AğŸ‘¤ *Cliente:* ${n}%0AğŸ“ *MOD:* ${document.getElementById('modalidad').value.toUpperCase()}%0A%0A`;
        cart.forEach((it) => { 
            msg += `ğŸ´ *${it.name}* ${it.ent} ${it.pri} ${it.pts}%0A`; 
        });
        if(p === 'Transferencia') msg += `%0AğŸ“¸ *ADJUNTA COMPROBANTE AQUÃ.*`;
        msg += `%0A%0AğŸ’° *TOTAL: $${totalGlobal.toLocaleString('es-CL')}*%0AğŸ’³ *Pago:* ${p}%0AğŸ“ ${document.getElementById('observaciones').value}`;
        window.open(`https://wa.me/56994004188?text=${msg}`);
    }
</script>
</body>
    </html>
    
